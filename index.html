<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="description" content="HexCraft 3D - Build voxel worlds with hexagonal blocks">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    <link rel="apple-touch-icon" href="icons/icon.svg">
    <title>HexCraft 3D - Voxel World Builder</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- 3D Canvas Container -->
        <div id="canvas-container"></div>

        <!-- Header Toolbar -->
        <header class="toolbar">
            <div class="toolbar-left">
                <h1 class="logo">
                    <span class="logo-icon">&#x2B21;</span>
                    <span class="logo-text">HexCraft 3D</span>
                </h1>
            </div>
            <div class="toolbar-center">
                <div class="info-group">
                    <span class="info-label">Material:</span>
                    <span id="current-material" class="info-value">Stone</span>
                </div>
                <div class="divider"></div>
                <div class="info-group">
                    <span class="info-label">Brush:</span>
                    <span id="brush-size" class="info-value">1</span>
                </div>
                <div class="divider"></div>
                <div class="tool-group">
                    <button class="tool-btn" id="mode-btn" title="Toggle Mode (F)">Fly (F)</button>
                </div>
            </div>
            <div class="toolbar-right">
                <button class="tool-btn" id="sound-btn" title="Toggle Sound (M)">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
                </button>
                <button class="tool-btn" id="help-btn" title="Help">?</button>
            </div>
        </header>

        <!-- Material Palette (left side) -->
        <aside class="material-sidebar" id="material-sidebar">
            <div class="palette-header">
                <span>Materials</span>
            </div>
            <div id="material-palette" class="material-palette">
                <!-- Materials generated by JS -->
            </div>
            <div class="palette-footer">
                <div class="hotkey-hint">1-9 to select</div>
                <div class="hotkey-hint">Q/E brush size</div>
            </div>
        </aside>

        <!-- Crosshair (fly mode) -->
        <div id="crosshair" class="crosshair" style="display: none;">
            <div class="crosshair-h"></div>
            <div class="crosshair-v"></div>
        </div>

        <!-- Mode Indicator -->
        <div id="mode-indicator" class="mode-indicator">Orbit Mode</div>

        <!-- Controls Help Panel -->
        <div id="controls-help" class="controls-help">
            <div class="help-header">
                <span>Controls</span>
                <button class="close-btn" id="close-help">&times;</button>
            </div>
            <div class="help-content">
                <div class="help-section">
                    <h3>Camera</h3>
                    <div class="help-row"><kbd>F</kbd> Toggle Fly/Orbit mode</div>
                    <div class="help-row"><kbd>WASD</kbd> Move (fly mode)</div>
                    <div class="help-row"><kbd>Space</kbd> Up / <kbd>Shift</kbd> Down</div>
                    <div class="help-row"><kbd>Ctrl</kbd> Sprint</div>
                    <div class="help-row">Mouse drag to rotate (orbit)</div>
                    <div class="help-row">Scroll to zoom</div>
                </div>
                <div class="help-section">
                    <h3>Building</h3>
                    <div class="help-row"><kbd>Left Click</kbd> Place block</div>
                    <div class="help-row"><kbd>Right Click</kbd> Remove block</div>
                    <div class="help-row"><kbd>1-9</kbd> Select material</div>
                    <div class="help-row"><kbd>Q/E</kbd> Brush size -/+</div>
                </div>
                <div class="help-section">
                    <h3>Other</h3>
                    <div class="help-row"><kbd>Ctrl+Z</kbd> Undo</div>
                    <div class="help-row"><kbd>Ctrl+Y</kbd> Redo</div>
                    <div class="help-row"><kbd>M</kbd> Toggle sound</div>
                </div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div class="toast-container" id="toastContainer"></div>

        <!-- Mobile Bottom Toolbar -->
        <nav class="mobile-toolbar" id="mobileToolbar">
            <button class="mobile-tool" id="mobile-materials">
                <div class="mobile-material-preview"></div>
                <span>Material</span>
            </button>
            <button class="mobile-tool" id="mobile-mode">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 5.5L10 8H14L12 5.5M18 10L20.5 12L18 14V10M6 10V14L3.5 12L6 10M12 18.5L14 16H10L12 18.5M12 8C9.79 8 8 9.79 8 12S9.79 16 12 16 16 14.21 16 12 14.21 8 12 8Z"/></svg>
                <span>Mode</span>
            </button>
            <button class="mobile-tool" id="mobile-undo">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/></svg>
                <span>Undo</span>
            </button>
            <button class="mobile-tool" id="mobile-help">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/></svg>
                <span>Help</span>
            </button>
        </nav>

        <!-- Mobile Material Picker -->
        <div class="mobile-material-overlay" id="mobileMaterialOverlay">
            <div class="mobile-material-content">
                <div class="mobile-material-header">
                    <span>Select Material</span>
                    <button class="close-btn" id="closeMobileMaterial">&times;</button>
                </div>
                <div class="mobile-material-grid" id="mobileMaterialGrid"></div>
            </div>
        </div>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script src="app.js"></script>
    <script>
        // UI event handlers
        document.getElementById('help-btn')?.addEventListener('click', () => {
            document.getElementById('controls-help').classList.toggle('active');
        });
        document.getElementById('close-help')?.addEventListener('click', () => {
            document.getElementById('controls-help').classList.remove('active');
        });
        document.getElementById('mobile-help')?.addEventListener('click', () => {
            document.getElementById('controls-help').classList.toggle('active');
        });
        document.getElementById('mode-btn')?.addEventListener('click', () => {
            if (typeof toggleMode === 'function') toggleMode();
        });
        document.getElementById('mobile-mode')?.addEventListener('click', () => {
            if (typeof toggleMode === 'function') toggleMode();
        });
        document.getElementById('sound-btn')?.addEventListener('click', () => {
            if (typeof audio !== 'undefined') {
                const enabled = audio.toggle();
                updateSoundButton(enabled);
            }
        });
        document.getElementById('mobile-undo')?.addEventListener('click', () => {
            if (typeof undo === 'function') undo();
        });

        // Mobile material picker
        document.getElementById('mobile-materials')?.addEventListener('click', () => {
            document.getElementById('mobileMaterialOverlay').classList.add('active');
        });
        document.getElementById('closeMobileMaterial')?.addEventListener('click', () => {
            document.getElementById('mobileMaterialOverlay').classList.remove('active');
        });

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed:', err));
            });
        }
    </script>
</body>
</html>
